version: "3"
services:
  vulnado:
    build: .
    ports:
      - 8080:8080
    links:
      - db
      - internal_site
    environment:
      - PGPASSWORD=vulnado
      - PGDATABASE=vulnado
      - PGHOST=db:5432
      - PGUSER=postgres
    depends_on:
      - "db"
    networks:
      - internal
      - web

  client:
    build: client
    ports:
      - 1337:80
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.vulnado.rule=Host(`vulnado.localhost`)"
      - "traefik.http.routers.vulnado.entrypoints=web"
    depends_on:
      - traefik
    networks:
      - internal
      - web

  db:
    image: postgres
    environment:
      - POSTGRES_PASSWORD=vulnado
      - POSTGRES_DB=vulnado

  internal_site:
    build: internal_site
    networks:
      - internal
      - web


networks:
  web:
    external: true
  internal:
    external: false
